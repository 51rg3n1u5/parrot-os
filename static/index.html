<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParrotOS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; background: #1a1a2e; color: #eee; }
        
        .menu { display: flex; background: #16213e; padding: 10px; gap: 10px; }
        .menu button { flex: 1; padding: 15px; font-size: 18px; border: none; background: #0f3460; color: #aaa; cursor: pointer; border-radius: 8px; }
        .menu button.active { background: #e94560; color: #fff; }
        
        .status { display: flex; background: #0f3460; padding: 10px; justify-content: space-around; font-size: 14px; }
        .status span { color: #4ecca3; font-weight: bold; }
        
        .page { display: none; min-height: calc(100vh - 100px); }
        .page.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        #game { position: relative; background: #0d1b2a; }
        
        .target {
            position: absolute; width: 80px; height: 80px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 40px; cursor: pointer; user-select: none;
        }
        .food { background: linear-gradient(#f39c12, #e74c3c); }
        .toy { background: linear-gradient(#9b59b6, #3498db); }
        .fruit { background: linear-gradient(#2ecc71, #27ae60); }
        
        .breath { width: 120px; height: 120px; border-radius: 50%; background: radial-gradient(#415a77, #1b263b); animation: b 4s ease-in-out infinite; }
        @keyframes b { 0%,100% { transform: scale(1); } 50% { transform: scale(1.4); } }
        
        .sec { background: #16213e; padding: 20px; border-radius: 8px; margin: 10px; }
        .btn { padding: 15px 30px; background: #4ecca3; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="menu">
        <button id="b1" onclick="go('home', this)">Hem</button>
        <button id="b2" onclick="go('game', this)">Lek</button>
        <button id="b3" onclick="go('calm', this)">Lugnt</button>
        <button id="b4" onclick="go('admin', this)">Admin</button>
    </div>
    
    <div class="status">
        <div>Mat: <span id="pellets">--</span></div>
        <div>Bonus: <span id="bonus">--</span></div>
        <div>Po√§ng: <span id="score">0</span></div>
    </div>
    
    <div id="home" class="page active">
        <h1 style="font-size:48px">ü¶ú ParrotOS</h1>
        <p style="color:#888">Tryck p√• Lek</p>
    </div>
    
    <div id="game" class="page">
        <div style="position:absolute;top:10px;left:10px;font-size:24px;color:#4ecca3">Po√§ng: <span id="pts">0</span></div>
    </div>
    
    <div id="calm" class="page">
        <div class="breath"></div>
        <p style="margin-top:20px;color:#778da9;font-size:20px">Shh...</p>
    </div>
    
    <div id="admin" class="page">
        <h2 style="color:#4ecca3">Admin</h2>
        <div class="sec">
            <h3>Utfodring</h3>
            <p>Mat idag: <span id="admin-p">--</span></p>
            <button class="btn" onclick="feed(10)">Ge 10g</button>
        </div>
        <div class="sec">
            <h3>WLED</h3>
            <button class="btn" onclick="wled('rainbow')">Regnb√•ge</button>
            <button class="btn" onclick="wled('off')">Av</button>
        </div>
    </div>

    <script>
        let pts = 0;
        let gameOn = false;
        let targets = [];
        const gameEl = document.getElementById('game');
        
        // Simple page navigation
        function go(page, btn) {
            console.log('go:', page);
            
            // Buttons
            document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            // Game control
            if (page === 'game' && !gameOn) {
                startGame();
            } else if (page !== 'game' && gameOn) {
                stopGame();
            }
        }
        
        function startGame() {
            console.log('startGame');
            gameOn = true;
            pts = 0;
            document.getElementById('pts').textContent = '0';
            
            // Create initial targets
            for (let i = 0; i < 3; i++) {
                setTimeout(() => spawn(), i * 100);
            }
            
            // Animation loop
            animate();
        }
        
        function stopGame() {
            console.log('stopGame');
            gameOn = false;
            targets.forEach(t => t.remove());
            targets = [];
        }
        
        function spawn() {
            if (!gameOn) return;
            
            const types = [
                {c:'food',e:'üå∞'},{c:'toy',e:'üß∏'},{c:'fruit',e:'üçé'}
            ];
            const t = types[Math.floor(Math.random() * types.length)];
            
            const el = document.createElement('div');
            el.className = 'target ' + t.c;
            el.textContent = t.e;
            
            const w = gameEl.clientWidth || 300;
            const h = gameEl.clientHeight || 400;
            
            el.style.left = (Math.random() * (w - 90)) + 'px';
            el.style.top = (Math.random() * (h - 90)) + 'px';
            
            el.onclick = function() {
                pts += 10;
                document.getElementById('pts').textContent = pts;
                el.remove();
                targets = targets.filter(x => x.el !== el);
                spawn();
            };
            
            gameEl.appendChild(el);
            
            targets.push({
                el: el,
                x: parseFloat(el.style.left),
                y: parseFloat(el.style.top),
                vx: (Math.random() - 0.5) * 8,
                vy: (Math.random() - 0.5) * 8
            });
        }
        
        function animate() {
            if (!gameOn) return;
            
            const w = gameEl.clientWidth || 300;
            const h = gameEl.clientHeight || 400;
            
            targets.forEach(t => {
                t.x += t.vx;
                t.y += t.vy;
                
                if (t.x <= 0 || t.x >= w - 90) { t.vx *= -1; t.x = Math.max(0, Math.min(t.x, w - 90)); }
                if (t.y <= 0 || t.y >= h - 90) { t.vy *= -1; t.y = Math.max(0, Math.min(t.y, h - 90)); }
                
                t.el.style.left = t.x + 'px';
                t.el.style.top = t.y + 'px';
            });
            
            requestAnimationFrame(animate);
        }
        
        // API
        async function feed(g) {
            try {
                const r = await fetch('/api/feed?amount=' + g, {method: 'POST'});
                const d = await r.json();
                document.getElementById('admin-p').textContent = d.total_today + 'g';
                loadState();
            } catch(e) { console.error(e); }
        }
        
        async function wled(v) {
            try { await fetch('/api/wled/' + v); } 
            catch(e) { console.error(e); }
        }
        
        async function loadState() {
            try {
                const s = await fetch('/api/state').then(r => r.json());
                document.getElementById('pellets').textContent = s.pellets_today + '/' + s.pellet_budget + 'g';
                document.getElementById('bonus').textContent = s.bonus_earned + 'g';
                document.getElementById('admin-p').textContent = s.pellets_today + 'g';
            } catch(e) { console.error(e); }
        }
        
        loadState();
        setInterval(loadState, 10000);
    </script>
</body>
</html>
